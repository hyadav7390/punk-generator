version: "3.8"

services:
  ipfs:
    image: ipfs/kubo:latest
    container_name: ipfs-kubo
    restart: unless-stopped
    environment:
      - IPFS_PROFILE=server
    command: ["daemon", "--migrate=true"]
    ports:
      # IMPORTANT: keep the API bound to localhost for safety
      - "127.0.0.1:${IPFS_API_PORT:-5001}:5001"   # API (admin) - DO NOT EXPOSE PUBLICLY
      - "${IPFS_GATEWAY_PORT:-8080}:8080"         # Gateway (public ok, ideally via nginx/certbot)
      - "${IPFS_SWARM_TCP_PORT:-4001}:4001/tcp"   # Swarm TCP (public)
      - "${IPFS_SWARM_QUIC_PORT:-4001}:4001/udp"  # Swarm QUIC/UDP (public)
    volumes:
      - ./ipfs/data:/data/ipfs
      - ./ipfs/staging:/export
